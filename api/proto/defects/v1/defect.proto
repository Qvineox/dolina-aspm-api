syntax = "proto3";

package dolina.defects.v1;

option go_package = "gitlab.domsnail.ru/dolina/dolina-aspm-api/api/gen/go/defects/v1;defects_v1";

import "google/protobuf/timestamp.proto";
import "common/v1/paging.proto";
import "common/v1/sort.proto";

message Defect {
  string uuid = 1;

  string title = 2;
  string description = 3;

  //  DefectType type = 4;

  // risk score is based on inputs from security scanners and applied ruleset
  uint32 applied_risk_score = 5;
  uint32 cvss_score = 6;

  // deduplication
  bool is_latest = 9;
  repeated Defect defect_duplicates = 10;

  // membership attributes
  optional string component_purl = 20;

  optional uint32 application_id = 21;
  optional string application_ref = 22; // git ref of an application to define where defect was found

  optional google.protobuf.Timestamp created_at = 23;
  optional google.protobuf.Timestamp updated_at = 24;
}

message Defects {
  repeated Defect defects = 1;
}

enum DefectType {
  DEFECT_TYPE_UNSPECIFIED = 0;

  DEFECT_TYPE_SAST = 1;
  DEFECT_TYPE_DAST = 2;
  DEFECT_TYPE_SCA = 3;
}

message DefectsQueryFilter {
  string title = 1;

  optional string component_purl = 2;

  optional uint32 application_id = 5;
  optional string application_ref = 6;

  common.v1.Paging paging = 23;
  common.v1.Sort sort = 24;
}