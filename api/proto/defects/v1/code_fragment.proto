edition = "2023";

package dolina.defects.v1;

option go_package = "gitlab.domsnail.ru/dolina/dolina-aspm-api/api/gen/go/defects/v1;defects_v1";
option features.(pb.go).api_level = API_OPAQUE;
option features.field_presence = IMPLICIT;

import "protoc-gen-openapiv2/options/annotations.proto";
import "google/protobuf/go_features.proto";

message CodeFragment {
  option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
    json_schema: {
      title: "Code fragment"
      description: "Source code fragment representation capturing vulnerable code snippets, secrets, or defects within "
          "files. Contains line numbers (start/end ranges), extracted code content, surrounding context lines, file path "
          "reference, and metadata about the detected issue type, severity, and detection source for remediation tracking "
          "in the ASPM system."
    }
  };

  string file_name = 1;
  string file_path = 2;

  uint32 line_start = 3;
  uint32 line_end = 4;

  string content = 5;

  // hidden segments offsets (also for secret masking)
  repeated LineSegment masked_segments_list = 6;
  repeated LineSegment highlighted_segments_list = 7;
}

message LineSegment {
  uint32 byte_start = 1;
  uint32 byte_end = 2;
}