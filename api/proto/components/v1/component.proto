edition = "2023";

package dolina.components.v1;

option go_package = "gitlab.domsnail.ru/dolina/dolina-aspm-api/api/gen/go/components/v1;components_v1";
option features.(pb.go).api_level = API_OPAQUE;
option features.field_presence = IMPLICIT;

import "protoc-gen-openapiv2/options/annotations.proto";
import "google/protobuf/go_features.proto";
import "google/protobuf/timestamp.proto";

import "components/v1/purl.proto";
import "defects/v1/defect.proto";

message Component {
  option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
    json_schema: {
      title: "Component"
      description: "A software component that is part of an application's architecture."
          "Components can include libraries, frameworks, services, containers "
          "or other artifacts. Each component tracks metadata such as name, "
          "version, type, and securityâ€‘relevant attributes like vulnerabilities, "
          "licenses, and dependencies. In Dolina ASPM, components are the primary "
          "units for assessing and managing application security posture."
    }
  };

  string uuid = 1;
  string scanner_uid = 2; // internal scanner component id
  PURL purl = 3;
  ComponentType type = 4;

  bool is_public = 5; // if component was obtained from public sources (npm, github etc.)

  uint32 application_id = 6;
  string repository_uuid = 7 [features.field_presence = EXPLICIT];
  string repository_ref = 8 [features.field_presence = EXPLICIT];

  string artifact_uuid = 9 [features.field_presence = EXPLICIT];

  repeated defects.v1.Defect defect_list = 10;
  repeated string dependency_purl_list = 11; // list of component dependencies

  google.protobuf.Timestamp created_at = 20 [features.field_presence = EXPLICIT];
  google.protobuf.Timestamp updated_at = 21 [features.field_presence = EXPLICIT];
}

// ssh -p 22 -vvv root@45.89.110.21

enum ComponentType {
  COMPONENT_TYPE_UNSPECIFIED = 0;

  COMPONENT_TYPE_LANGUAGE_PACKAGE = 1;
  COMPONENT_TYPE_CONTAINER_IMAGE = 2;
  COMPONENT_TYPE_OS_PACKAGE = 3;
  COMPONENT_TYPE_BUNDLE = 4;
  COMPONENT_TYPE_BINARY_EXECUTABLE = 5;
  COMPONENT_TYPE_MOBILE_APPLICATION = 6;
}