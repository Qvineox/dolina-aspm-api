syntax = "proto3";

package dolina.components.v1;

option go_package = "gitlab.domsnail.ru/dolina/dolina-aspm-api/api/gen/go/components/v1;components_v1";

import "protoc-gen-openapiv2/options/annotations.proto";

import "google/protobuf/timestamp.proto";

import "components/v1/purl.proto";
import "defects/v1/defect.proto";
import "common/v1/paging.proto";
import "common/v1/sort.proto";


message Component {
  option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
    json_schema: {
      title: "Component"
      description: "A software component that is part of an application's architecture."
          "Components can include libraries, frameworks, services, containers "
          "or other artifacts. Each component tracks metadata such as name, "
          "version, type, and securityâ€‘relevant attributes like vulnerabilities, "
          "licenses, and dependencies. In Dolina ASPM, components are the primary "
          "units for assessing and managing application security posture."
    }
  };

  string uuid = 1;
  string scanner_uid = 2; // internal scanner component id
  PURL purl = 3;
  ComponentType type = 4;

  bool is_public = 5; // if component was obtained from public sources (npm, github etc.)

  optional string repository_uuid = 6;
  optional string repository_ref = 7;

  optional string artifact_uuid = 8;

  repeated defects.v1.Defect defect_list = 10;

  optional google.protobuf.Timestamp created_at = 20;
  optional google.protobuf.Timestamp updated_at = 21;
}

message Components {
  repeated Component component_list = 1;
}

message ComponentsQueryFilter {
  string purl = 1;

  optional string repository_uuid = 4;
  optional string repository_ref = 5;
  optional string artifact_uuid = 6;

  common.v1.Paging paging = 20;
  common.v1.Sort sort = 21;
}

enum ComponentType {
  COMPONENT_TYPE_UNSPECIFIED = 0;

  COMPONENT_TYPE_LANGUAGE_PACKAGE = 1;
  COMPONENT_TYPE_CONTAINER_IMAGE = 2;
  COMPONENT_TYPE_OS_PACKAGE = 3;
  COMPONENT_TYPE_BUNDLE = 4;
  COMPONENT_TYPE_BINARY_EXECUTABLE = 5;
  COMPONENT_TYPE_MOBILE_APPLICATION = 6;
}