syntax = "proto3";

package dolina.reports.v1;

option go_package = "gitlab.domsnail.ru/dolina/dolina-aspm-api/api/gen/go/reports/v1;reports_v1";

import "protoc-gen-openapiv2/options/annotations.proto";

import "reports/v1/scanners.proto";
import "common/v1/paging.proto";

message Report {
  option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
    json_schema: {
      title: "Report"
      description: "A comprehensive security assessment report generated by Dolina ASPM after "
          "analyzing one or more scanner reports. It contains normalized findings, "
          "risk scores, severity classifications, remediation recommendations, and "
          "contextual metadata (e.g., affected components, code locations). This report "
          "provides a unified view of the application's security posture, enabling "
          "prioritization and tracking of vulnerabilities across the software development lifecycle."
    }
  };

  string uuid = 1;

  repeated ScannerReport scanner_reports = 2;

  // membership attributes
  optional uint32 project_id = 3;
  optional uint32 application_id = 4;
  optional string repository_uuid = 5;
  optional string artifact_uuid = 6;

  // ci/cd attributes
  optional string pipeline_id = 8;

  // todo: report data
}

message Reports {
  repeated Report reports = 1;
}

message ReportPatch {
  string uuid = 1;
}

message ReportsQueryFilter {
  optional uint32 project_id = 2;
  optional string project_slug = 3; // ignored if project_id is provided

  optional uint32 application_id = 4;
  optional string application_slug = 5; // ignored if application_id is provided

  // create or update project repository by provided attributes
  optional string repository_uuid = 6;
  optional string repository_url = 7; // ignored if repository_uuid is provided

  // create or update project artifact by provided attributes
  optional string artifact_uuid = 8;
  optional string artifact_purl = 9;

  optional ScannerID scanner_id = 10;
  optional ScannerFormat scanner_format = 11;

  optional string pipeline_id = 12;

  common.v1.Paging paging = 20;
}